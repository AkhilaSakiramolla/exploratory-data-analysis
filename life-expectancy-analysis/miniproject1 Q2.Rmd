---
title: "Miniproject Q2"
author: "Mitali"
date: "2/13/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
install.packages("gapminder")
library(gapminder)
```

```{r}
data <- subset.data.frame(gapminder)
data
```

```{r}
library(ggplot2)
library(tidyverse)
df_grp <- data %>% 
  group_by(continent,year) %>% 
  summarise(weighted_mean = weighted.mean(lifeExp, pop))
df_grp
```



```{r}
ggplot(df_grp,aes(x = df_grp$year, y = df_grp$weighted_mean)) + geom_line() + facet_wrap(. ~ df_grp$continent) + xlab("Year") + ylab("Life expectation(weighted average)") + ggtitle("Weighted mean of each life expectancy for each Continent over time")
```
We can see that for the continents Americas,Europe and Oceania, the weighted mean of life expectancy ranges from approximately around 60 to 80. 
But for continents like Africa,Asia the scale for weighted mean of life expectancy ranges from around 40 to 55 & 70 respectively.
We can observe that the even though in the initial years the life expectancy values are small they seem to have caught up for Asia, and partially almost caught up for Africa,with the Americas,Europe and Oceania. 
We dig deeper to check if the countries in these continents are the reason behind this.

For the continents of Americas,Europe and Oceania, the life expectancy seems to have an approximately linear growth. We can say that with assurity, because Europe and Americas have substantial number of data points as opposed to Oceania. Since Oceania has only 2 countries, based on their trend, it is visible but not reliable to say that the trend is a linear upward going one.
For the continents of Africa and Asia, we see a sudden dip. 
In around 1990-2000, we observe that in Africa, there is a change in the linear path of the graph. This could be because of the individual countries in the continent. After we observe the facets of countries inside Africa, we observe a change in the graph direction around the same period(1990-2000), which could justify the change in the graph for the entire continent. 

```{r}
df_grp_country <- data %>% 
  group_by(country,continent) %>% 
  summarise(weighted_mean = weighted.mean(lifeExp, pop))
```

To further analyse, we filter out data into dataframes for each continent.

```{r fig.width=4, fig.height=10, echo=FALSE}
Africa <- filter(data, continent == "Africa")
Americas <- filter(data, continent == "Americas")
Asia <- filter(data, continent == "Asia")
Europe <- filter(data, continent == "Europe")
Oceania <- filter(data, continent == "Oceania")
```

```{r fig.width=6, fig.height=4, echo=FALSE}
df_Africa <- Africa %>% group_by(country,year) %>% summarise(wmean = weighted.mean(lifeExp))
df_Africa
ggplot(df_Africa,aes(y = wmean, x = year)) + geom_line() + facet_wrap(. ~ country,scales = "free_x") + ylab("Weighted mean of Life Expectancy")  + ggtitle("Life expectancy over years for Africa")
```
We try to observe the trends within each country of the Africa continent, but to dig deeper, since there is a plateau region around and beyond the year 1990, we try to plot the same
```{r}
df_Africa_period <- filter(Africa, year > 1990)
```

```{r fig.width=6, fig.height=4, echo=FALSE}
df_Africa_period <- df_Africa_period %>% group_by(country,year) %>% summarise(wmean = weighted.mean(lifeExp))
df_Africa_period
#ggplot(df_Africa_period,aes(y = wmean, x = year)) + geom_line() + facet_wrap(. ~ country,scales = "free_x")+ ylab("Weighted mean of Life Expectancy")  + ggtitle("Life expectancy over years more than 1990) for Africa")
```
To justify the flattening of weighted mean, we look at some numbers for the countries of Countries for the time period > 1990, we look at the average life Expectancy as well. This comes out to be around 50 approx, which could justify flattened graph around 50 for the continent of Africa
```{r}
Africa_period <- filter(Africa, year > 1990)
mean(Africa_period$lifeExp)
```

``````{r fig.width=4, fig.height=4, echo=FALSE}
df_Americas <- Americas %>% group_by(country,year) %>% summarise(wmean = weighted.mean(lifeExp))
df_Americas
ggplot(df_Americas,aes(y = wmean, x = year)) + geom_line() + facet_wrap(. ~ country,scales = "free_x") + ylab("Weighted mean of Life Expectancy")  + ggtitle("Life expectancy over years for Americas")
```

``````{r fig.width=6, fig.height=4, echo=FALSE}
df_Asia <- Asia %>% group_by(country,year) %>% summarise(wmean = weighted.mean(lifeExp))
df_Asia
ggplot(df_Asia,aes(y = wmean, x = year)) + geom_line() + facet_wrap(. ~ country,scales = "free_x") + ylab("Weighted mean of Life Expectancy")  + ggtitle("Life expectancy over years for Asia")
```


```{r fg.widht = 4, fig.height=4}
df_Asia_period <- df_Asia_period %>% group_by(country,year) %>% summarise(wmean = weighted.mean(lifeExp))
ggplot(df_Asia_period,aes(y = wmean, x = year)) + geom_line() + facet_wrap(. ~ country,scales = "free_x") + ylab("Weighted mean of Life Expectancy")  + ggtitle("Life expectancy over years(between 1950 to 1970) for Asia")
```


```{r fig.width=4, fig.height=4, echo=FALSE}
df_Europe <- Europe %>% group_by(country,year) %>% summarise(wmean = weighted.mean(lifeExp))
df_Europe
ggplot(df_Europe,aes(y = wmean, x = year)) + geom_line() + facet_wrap(. ~ country,scales = "free_x")+ ylab("Weighted mean of Life Expectancy")  + ggtitle("Life expectancy over years for Europe")
```

```{r fig.width=4, fig.height=2, echo=FALSE}
df_Oceania <- Oceania %>% group_by(country,year) %>% summarise(wmean = weighted.mean(lifeExp))
df_Oceania
ggplot(df_Oceania,aes(y = wmean, x = year)) + geom_line() + facet_wrap(. ~ country,scales = "free_x")+ ylab("Weighted mean of Life Expectancy")  + ggtitle("Life expectancy over years for Oceania")
```

Question 3:
#Coplot function
```{r}
make_coplot_df = function(data_frame, faceting_variable, number_bins = 6) {
    ## co.intervals gets the limits used for the conditioning intervals
    intervals = co.intervals(data_frame[[faceting_variable]], number = number_bins)
    ## indices is a list, with the ith element containing the indices of the
    ## observations falling into the ith interval
    indices = apply(intervals, 1, function(x)
        which(data_frame[[faceting_variable]] <= x[2] & data_frame[[faceting_variable]] >= x[1]))
    ## interval_descriptions is formatted like indices, but has interval
    ## names instead of indices of the samples falling in the index
    interval_descriptions = apply(intervals, 1, function(x) {
        num_in_interval = sum(data_frame[[faceting_variable]] <= x[2] & data_frame[[faceting_variable]] >= x[1])
        interval_description = sprintf("(%.2f, %.2f)", x[1], x[2])
        return(rep(interval_description, num_in_interval))
    })
    ## df_expanded has all the points we need for each interval, and the
    ## 'interval' column tells us which part of the coplot the point should
    ## be plotted in
    df_expanded = data_frame[unlist(indices),]
    df_expanded$interval = factor(unlist(interval_descriptions),
        levels = unique(unlist(interval_descriptions)), ordered = TRUE)
    return(df_expanded)
}
```

```{r}
head(data)
```







```{r}
library(dplyr)
Asia_countries <- c("China","Hong Kong, China","Israel","Japan","Singapore","Sri Lanka","Oman","Cambodia","Afghanistan","Bangladesh","Vietnam","Yemen, Rep.","India")

Asia_subset <- filter(data, country %in% Asia_countries)
Asia_subset

grp_asia <-Asia_subset %>% group_by(country,year) %>% 
  summarise(weighted_mean = weighted.mean(lifeExp, pop))
grp_asia
```

```{r}
ggplot(grp_asia, aes(x = year, y = weighted_mean, colour = country)) +
  geom_line() + xlab(("Year")) +ylab(("Life expectancy(weighted average)")) + ggtitle("Life expectancy over the years across few Asian countries")
```

```{r}
data_gdp <- data %>% group_by(continent,year) %>% summarise(lifeExp,gdp = log(gdpPercap))
data_gdp
```

```{r fig.width= 5}
ggplot(data_gdp, aes(y = lifeExp, x = gdp, colour = continent)) + facet_wrap(. ~ year,scales = "free") +
  geom_point()+ geom_smooth(method = "lm",se = F) + xlab(("GDP Per capita(log)")) + ylab(("Life expectancy")) + ggtitle("Life expectancy Vs GDP per capita over the years for Continents")
```